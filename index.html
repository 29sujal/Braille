<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Braille Communication (Continuous Mode)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dot {
      width: 3rem;
      height: 3rem;
      border-radius: 9999px;
      border: 2px solid #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #e5e7eb;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
    }

    .dot.on {
      background: #2563eb;
      color: white;
      border-color: #1e40af;
    }

    .dot.pulse {
      transform: scale(1.18);
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.28);
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start p-8">

  <h1 class="text-3xl font-bold mb-6 text-gray-800">Braille Communication</h1>

  <div class="mb-6 flex gap-2">
    <input id="inputText" type="text" placeholder="Enter text"
      class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
    <button id="loadBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">Load</button>
    <button id="playBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700">Play Message</button>
  </div>

  <div class="mb-6">
    <label class="flex items-center gap-2">
      <input type="checkbox" id="trainingMode" class="w-5 h-5">
      <span class="text-gray-700">Training Mode (slower vibrations + show numbers)</span>
    </label>
  </div>

  <!-- phone -->
  <div id="phone"
    class="w-56 h-96 bg-gray-700 rounded-3xl p-3 flex items-center justify-center shadow-lg cursor-pointer">
    <div class="w-full h-full bg-gray-300 rounded-2xl flex items-center justify-center">
      <div id="brailleDisplay" class="grid grid-rows-3 grid-cols-2 gap-4"></div>
    </div>
  </div>

  <p class="mt-4 text-gray-600">Click phone → Next character | Or press "Play Message" for auto output</p>
  <p id="currentChar" class="mt-2 text-lg font-semibold text-blue-600">Enter text above and click Load</p>

  <script>
    // Braille map
    const brailleMap = {
      "A": [1], "B": [1, 2], "C": [1, 4], "D": [1, 4, 5], "E": [1, 5],
      "F": [1, 2, 4], "G": [1, 2, 4, 5], "H": [1, 2, 5], "I": [2, 4], "J": [2, 4, 5],
      "K": [1, 3], "L": [1, 2, 3], "M": [1, 3, 4], "N": [1, 3, 4, 5], "O": [1, 3, 5],
      "P": [1, 2, 3, 4], "Q": [1, 2, 3, 4, 5], "R": [1, 2, 3, 5], "S": [2, 3, 4], "T": [2, 3, 4, 5],
      "U": [1, 3, 6], "V": [1, 2, 3, 6], "W": [2, 4, 5, 6], "X": [1, 3, 4, 6], "Y": [1, 3, 4, 5, 6], "Z": [1, 3, 5, 6],
      "1": [1], "2": [1, 2], "3": [1, 4], "4": [1, 4, 5], "5": [1, 5],
      "6": [1, 2, 4], "7": [1, 2, 4, 5], "8": [1, 2, 5], "9": [2, 4], "0": [2, 4, 5],
      ".": [2, 5, 6], ",": [2], " ": []
    };

    const brailleOrderForGrid = [1, 4, 2, 5, 3, 6];
    const brailleDisplay = document.getElementById("brailleDisplay");
    const currentChar = document.getElementById("currentChar");
    const phone = document.getElementById("phone");
    const inputText = document.getElementById("inputText");
    const loadBtn = document.getElementById("loadBtn");
    const playBtn = document.getElementById("playBtn");
    const trainingMode = document.getElementById("trainingMode");

    let sequence = [];
    let index = 0;
    let dotElements = {};

    function renderBraille(letter) {
      brailleDisplay.innerHTML = "";
      dotElements = {};
      currentChar.textContent = "Character: " + letter;

      brailleOrderForGrid.forEach(dot => {
        const dotDiv = document.createElement("div");
        dotDiv.className = "dot";
        if (brailleMap[letter] && brailleMap[letter].includes(dot)) {
          dotDiv.classList.add("on");
        }
        if (trainingMode.checked) {
          const span = document.createElement("span");
          span.textContent = dot;
          span.style.fontWeight = "700";
          dotDiv.appendChild(span);
        }
        brailleDisplay.appendChild(dotDiv);
        dotElements[dot] = dotDiv;
      });
    }

    // Vibrate with unique patterns for each dot
    const vibrationPatterns = {
      1: [200],
      2: [200, 100, 200],
      3: [400],
      4: [200, 200, 400],
      5: [600],
      6: [100, 100, 100, 300]
    };

    function vibrateLetter(letter, delay = 0) {
      if (!brailleMap[letter]) return Promise.resolve();
      return new Promise(res => {
        setTimeout(() => {
          const dots = brailleMap[letter];
          dots.forEach((dot, i) => {
            setTimeout(() => {
              if (navigator.vibrate) navigator.vibrate(vibrationPatterns[dot] || [150]);
            }, i * 300);
          });
          res();
        }, delay);
      });
    }

    // Continuous play of whole message
    async function playMessage() {
      if (!sequence.length) return;
      for (let i = 0; i < sequence.length; i++) {
        const letter = sequence[i];
        renderBraille(letter);
        await vibrateLetter(letter);
        await new Promise(r => setTimeout(r, trainingMode.checked ? 1200 : 700)); // gap between letters
      }
      currentChar.textContent = "Message finished ✅";
    }

    // Load text
    loadBtn.addEventListener("click", () => {
      const text = inputText.value
        .toUpperCase()
        .replace(/[^A-Z0-9., ]/g, "");
      if (!text) {
        alert("Please enter supported characters.");
        return;
      }
      sequence = text.split("");
      index = 0;
      renderBraille(sequence[index]);
    });

    // Swipe simulation (manual mode)
    phone.addEventListener("click", () => {
      if (!sequence.length) return;
      const letter = sequence[index];
      renderBraille(letter);
      vibrateLetter(letter);
      index = (index + 1) % sequence.length;
    });

    playBtn.addEventListener("click", playMessage);
  </script>
</body>
</html>
